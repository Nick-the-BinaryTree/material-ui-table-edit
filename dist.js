"use strict";var React=require("react"),mui=require("material-ui"),ModeEdit=require("material-ui/svg-icons/editor/mode-edit").default,Check=require("material-ui/svg-icons/navigation/check").default,Delete=require("material-ui/svg-icons/action/delete").default,times=require("lodash.times"),IconButton=mui.IconButton,Toggle=mui.Toggle,TextField=mui.TextField,RaisedButton=mui.RaisedButton,DatePicker=mui.DatePicker;module.exports=React.createClass({displayName:"exports",getDefaultProps:function(){return{headerColumns:[],rows:[],enableDelete:!0,onChange:function(){},onDelete:function(){}}},getInitialState:function(){return{rows:this.props.rows,hoverValue:!1,currentRow:!1}},contextTypes:{muiTheme:React.PropTypes.object.isRequired},update:function(){var e=this.state.rows.filter(function(e){return e.selected});this.props.onChange(e[0])},getCellValue:function(e){var t=this,n=e&&e.id,r=this.props.headerColumns.map(function(e){return e.type})[n],a=e&&e.selected,o=e&&e.value,l=e&&e.rowId,i=e&&e.header,s=e&&e.width,c=[n,l,i,"text"].join("-"),u=[n,l,i,"date"].join("-"),d={width:s},m={width:s},f=function(e,r){var a=t.state.rows;a[l].columns[n].value=r,t.setState({rows:a})},h=function(e){var r=t.state.rows;r[l].columns[n].value=!r[l].columns[n].value,t.setState({rows:r})};if(i||r&&"ReadOnly"===r)return React.createElement("p",{style:{color:"#888"}},o);if(r)if(a){if("TextField"===r)return React.createElement(TextField,{id:c,onChange:function(e){var r=e.target.value,a=t.state.rows;a[l].columns[n].value=r,t.setState({rows:a})},style:d,value:o,underlineFocusStyle:{borderColor:"#5d5d5e"},floatingLabel:!0});if("DatePicker"===r)return React.createElement(DatePicker,{id:u,onChange:f,mode:"landscape",style:m,value:o});if("Toggle"===r)return React.createElement(Toggle,{onToggle:h,toggled:o})}else{if("Toggle"===r)return React.createElement(Toggle,{disabled:!0,onToggle:h,toggled:o});if("DatePicker"===r)return React.createElement(DatePicker,{id:u,onChange:f,mode:"landscape",style:m,value:o,disabled:Boolean(!0)})}return React.createElement(TextField,{id:c,style:d,disabled:!0,value:o})},renderHeader:function(){var e={columns:this.props.headerColumns.map(function(e,t){return{value:e.value}}),header:!0};return this.renderRow(e)},renderRow:function(e){var t=this,n=this,r=e.columns,a={width:"95vw",display:"flex",justifyContent:"space-around",flexFlow:"row nowrap",padding:e.header?0:12,border:0,borderBottom:"1px solid #ccc",height:50},o={display:"flex",flexFlow:"row nowrap",width:50,height:24,alignItems:"center"},l={display:"flex",flexFlow:"row nowrap",width:50,height:24,alignItems:"center",padding:"0 12 0"},i=e.id,s=["row",i].join("-"),c=function(e){var t=n.state.rows;t.forEach(function(e,t){i!==t&&(e.selected=!1)}),t[i].selected=!t[i].selected,n.setState({rows:t})},u=n.state.rows[i],d=u&&u.selected||!1,m=d?React.createElement(Check,null):React.createElement(ModeEdit,null),f=d?"Done":"Edit",h=!this.props.enableDelete||d||e.header?React.createElement("div",{style:l}):React.createElement(IconButton,{style:l,tooltip:"Delete this row",onClick:function(e){var t=n.state.rows,r={};t.forEach(function(e,n){i===n&&(t.splice(n,1),r={rowId:i,row:e})}),t.forEach(function(e,t){e.id=t}),n.setState({rows:t}),r!=={}&&n.props.onDelete(r)}},React.createElement(Delete,null)),p=e.header?React.createElement("div",{style:o}):React.createElement(IconButton,{style:o,tooltip:f,onClick:function(e){d&&n.update(),c()}},m);return React.createElement("div",{key:s,className:"row",style:a},p,r.map(function(n,r){var a={display:"flex",flexFlow:"row nowrap",flexGrow:.15,flexBasis:"content",justifyContent:"center",alignItems:"center",height:30,width:t.props.headerColumns.map(function(e){return e&&e.width||!1})[r]||200},o=["column",r].join("-");return n.selected=d,n.rowId=i,n.id=r,n.header=e.header,n.width=a.width,React.createElement("div",{key:o,className:"cell",style:a},React.createElement("div",null,t.getCellValue(n)))}),h)},render:function(){var e=this,t=this,n={display:"flex",flexFlow:"column nowrap",justifyContent:"space-between",alignItems:"center",fontFamily:"Roboto, sans-serif"},r={display:"flex",flexFlow:"row nowrap",marginTop:10},a=this.state.rows,o=this.props.headerColumns.map(function(e){return e.type});return React.createElement("div",{className:"container",style:n},this.renderHeader(),a.map(function(t,n){return t.id=n,e.renderRow(t)}),React.createElement(RaisedButton,{onClick:function(e){var n=times(o.length,function(e){return{value:{TextField:"",Toggle:!0}[o[e]]}}),r=a.map(function(e){return e.selected&&(t.update(),e.selected=!1),e});r.push({columns:n,selected:!0}),t.setState({rows:r})},style:r,label:"Add Row"}))}});
